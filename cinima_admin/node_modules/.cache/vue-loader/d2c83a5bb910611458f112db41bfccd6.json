{"remainingRequest":"/Users/gujianyang/IdeaProjects/cinima_admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/gujianyang/IdeaProjects/cinima_admin/src/views/doc/hall/site-doc.vue?vue&type=style&index=0&id=5ce82f07&scoped=true&lang=css&","dependencies":[{"path":"/Users/gujianyang/IdeaProjects/cinima_admin/src/views/doc/hall/site-doc.vue","mtime":1621523436884},{"path":"/Users/gujianyang/IdeaProjects/cinima_admin/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/gujianyang/IdeaProjects/cinima_admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/gujianyang/IdeaProjects/cinima_admin/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/gujianyang/IdeaProjects/cinima_admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/gujianyang/IdeaProjects/cinima_admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLnNjcmVlbnsKICB3aWR0aDogOTAlOwogIGhlaWdodDogNTBweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjNmNGY2OwogIG1hcmdpbjogMCBhdXRvOwp9Ci5zY3JlZW4tdGV4dHsKICBjb2xvcjogIzZCQTJENjsKICBsaW5lLWhlaWdodDogNTBweDsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICBmb250LXNpemU6IDIwcHg7Cn0KLnNpdGVfbWFwX2NvbnRlbnR7CiAgd2lkdGg6IDkwJTsKICBtYXJnaW46IDMwcHggYXV0byAwOwp9Ci5udW1iZXJ7CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIGNvbG9yOiAjZmZmOwogIG1hcmdpbjogMDsKICBib3JkZXI6IDA7CiAgZm9udC1zaXplOiAxMDAlOwogIGZvbnQtd2VpZ2h0OiA0MDA7CiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgwLDAsMCwuMyk7CiAgdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOwogIHBhZGRpbmc6IDAgLjA1cmVtOwogIGhlaWdodDogNDBweDsKICB3aWR0aDogNDBweDsKICBtYXJnaW4tdG9wOiAyMHB4OwogIGxpbmUtaGVpZ2h0OiA0MHB4Owp9Ci5zaXRlX2xheW91dHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXg6IDE7CiAgbWFyZ2luOiAwIGF1dG87CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7Cn0KLm51bWJlcnsKICB3aWR0aDogNDBweDsKfQo="},{"version":3,"sources":["site-doc.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"site-doc.vue","sourceRoot":"src/views/doc/hall","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <div class=\"filter-container\" style=\"margin: 0;padding: 0\">\n      <div class=\"el-form-item__content\" style=\"display: block;margin: 0;padding: 0\">\n        <span class=\" el-form-item__label\">当前选择影院:</span>\n        <span class=\" el-form-item__label\" style=\"color: deepskyblue\">\n          {{ cinema }}\n        </span>\n      </div>\n      <span class=\" el-form-item__label\">行:</span>\n      <el-input v-model=\"tempRow\" placeholder=\"行\" label=\"行\" style=\"width: 200px; margin-right: 10px\" class=\"filter-item\" @keyup.enter.native=\"changeSiteNumber\" />\n      <span class=\"filter-item el-form-item__label\" style=\"float: none\">列:</span>\n      <el-input v-model=\"tempCol\" placeholder=\"列\" label=\"列\" style=\"width: 200px;\" class=\"filter-item\" @keyup.enter.native=\"changeSiteNumber\" />\n      <el-button class=\"filter-item\" style=\"margin-left: 10px;\" type=\"primary\" icon=\"el-icon-refresh-left\" @click=\"rebuildSiteMap\">\n        重新生成座位\n      </el-button>\n      <span class=\"filter-item el-form-item__label\" style=\"float: none;margin-left: 10px\">当前选择设置:</span>\n      <el-select v-model=\"selectType\" placeholder=\"座位类型\" class=\"filter-item\" style=\"width: 130px;margin-left: 10px\">\n        <el-option label=\"普通单人座\" :value=\"normal\" />\n        <el-option label=\"情侣座\" :value=\"lovers\" />\n        <el-option label=\"过道\" :value=\"gd\" />\n        <el-option label=\"维修\" :value=\"bad\" />\n      </el-select>\n      <el-button class=\"filter-item\" style=\"margin-left: 10px;\" type=\"success\" icon=\"el-icon-document-checked\" @click=\"uploadSiteData\">\n        保存\n      </el-button>\n    </div>\n    <div class=\"screen\">\n      <div class=\"screen-text\">屏幕方向</div>\n    </div>\n    <div class=\"site_map_content\">\n      <div v-for=\"index in row\" :key=\"index\">\n        <div class=\"site_layout\">\n          <div class=\"number\" style=\"margin-right: 20px\">{{ index }}</div>\n          <div v-for=\"col_index in col\" :key=\"col_index\" style=\"width: 46px\">\n            <el-image v-model=\"map[index-1][col_index-1].src\" :src=\"map[index-1][col_index-1].src\" alt=\"\" height=\"46px\" width=\"46px\" style=\"margin-top: 20px\" @click=\"resetSite(index-1,col_index-1)\" />\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { loadSite, uploadSite } from '@/api/doc_hall'\n\nexport default {\n  name: 'SiteDoc',\n  filters: {\n    statusFilter(status) {\n      const statusMap = {\n        1: 'success',\n        0: 'danger'\n      }\n      return statusMap[status]\n    }\n  },\n  data() {\n    return {\n      cinema: null,\n      hall: null,\n      row: 0, // 行\n      col: 0, // 列\n      normal: '/wx.png',\n      lovers: '/qlz_01.png',\n      lovers_r: '/qlz_02.png',\n      bad: '/gz.png',\n      gd: '/gd.png',\n      tempRow: 0,\n      tempCol: 0,\n      map: [[]],\n      selectType: null,\n      loading: null\n    }\n  },\n  created() {\n    this.cinema = this.$route.query.cinema\n    this.hall = this.$route.query\n    this.loadSiteData()\n  },\n  methods: {\n    loadSiteData() {\n      this.setLoading(true)\n      loadSite(this.hall.id).then(res => {\n        if (res.data !== null && res.data.length > 0 && res.data[0].length > 0) {\n          // 非首次加载\n          const row = res.data.length\n          const col = res.data[0].length\n          const map = []\n          for (const i in res.data) {\n            const item = []\n            for (const j in res.data[i]) {\n              let src\n              switch (res.data[i][j].type) {\n                case 1:\n                  src = this.normal\n                  break\n                case -1:\n                  src = this.bad\n                  break\n                case 0:\n                  src = this.gd\n                  break\n                case 2:\n                  src = this.lovers\n                  break\n                case 3:\n                  src = this.lovers_r\n                  break\n              }\n              item.push({\n                src: src\n              })\n            }\n            map.push(item)\n          }\n          this.map = map\n          this.row = row\n          this.col = col\n          this.tempCol = col\n          this.tempRow = row\n        } else {\n          this.$message({\n            message: '此放映厅未设置位置',\n            type: 'warning'\n          })\n          this.row = 0\n          this.col = 0\n          this.tempCol = 0\n          this.tempRow = 0\n          this.initMap(this.row, this.col)\n        }\n        this.selectType = this.normal\n        this.setLoading(false)\n      }).catch(e => {\n        this.setLoading(false)\n        throw e\n      })\n    },\n    initMap(row, col) {\n      this.map = []\n      for (let i = 0; i < row; i++) {\n        const arr = []\n        for (let j = 0; j < col; j++) {\n          arr.push({\n            src: this.normal\n          })\n        }\n        this.map.push(arr)\n      }\n    },\n    changeSiteNumber() {\n\n    },\n    rebuildSiteMap() {\n      this.initMap(this.tempRow, this.tempCol)\n      this.col = Number(this.tempCol)\n      this.row = Number(this.tempRow)\n    },\n    resetSite(row, col) {\n      if (this.map[row][col].src === this.selectType) { return }\n      if (this.selectType === this.lovers) {\n        if (col === this.col - 1) {\n          this.$message.error('情侣座需要右边有空余位置')\n          return\n        } else if (this.map[row][col + 1].src !== this.normal) {\n          this.$message.error('情侣座需要两个位置，但此座位右边不为普通座')\n          return\n        } else if (this.map[row][col].src !== this.normal) {\n          this.$message.error('当前选择位置不为普通座')\n          return\n        }\n        this.map[row][col + 1].src = this.lovers_r\n      } else {\n        if (this.map[row][col].src === this.lovers) {\n          this.map[row][col + 1].src = this.selectType\n        } else if (this.map[row][col].src === this.lovers_r) {\n          this.map[row][col - 1].src = this.selectType\n        }\n      }\n      this.map[row][col].src = this.selectType\n    },\n    setLoading(show) {\n      if (show) {\n        this.loading = this.$loading({\n          lock: true,\n          text: 'Loading',\n          spinner: 'el-icon-loading',\n          background: 'rgba(0, 0, 0, 0.7)'\n        })\n      } else {\n        this.loading.close()\n      }\n    },\n    uploadSiteData() {\n      this.setLoading(true)\n      const upData = []\n      for (const i in this.map) {\n        const dataItem = []\n        for (const j in this.map[i]) {\n          const src = this.map[i][j].src\n          let type\n          switch (src) {\n            case this.normal:\n              type = 1\n              break\n            case this.bad:\n              type = -1\n              break\n            case this.gd:\n              type = 0\n              break\n            case this.lovers:\n              type = 2\n              break\n            case this.lovers_r:\n              type = 3\n              break\n          }\n          dataItem.push({\n            type: type\n          })\n        }\n        upData.push(dataItem)\n      }\n      uploadSite({\n        sites: upData,\n        hallId: this.hall.id\n      }).then(res => {\n        this.setLoading(false)\n        this.$notify({\n          title: '成功',\n          message: '更新成功',\n          type: 'success',\n          duration: 2000\n        })\n      }).catch(e => {\n        this.setLoading(false)\n        throw e\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n  .screen{\n    width: 90%;\n    height: 50px;\n    background-color: #f3f4f6;\n    margin: 0 auto;\n  }\n  .screen-text{\n    color: #6BA2D6;\n    line-height: 50px;\n    text-align: center;\n    white-space: nowrap;\n    font-size: 20px;\n  }\n  .site_map_content{\n    width: 90%;\n    margin: 30px auto 0;\n  }\n  .number{\n    text-align: center;\n    color: #fff;\n    margin: 0;\n    border: 0;\n    font-size: 100%;\n    font-weight: 400;\n    background-color: rgba(0,0,0,.3);\n    vertical-align: baseline;\n    padding: 0 .05rem;\n    height: 40px;\n    width: 40px;\n    margin-top: 20px;\n    line-height: 40px;\n  }\n  .site_layout{\n    display: flex;\n    flex: 1;\n    margin: 0 auto;\n    justify-content: center;\n  }\n  .number{\n    width: 40px;\n  }\n</style>\n"]}]}